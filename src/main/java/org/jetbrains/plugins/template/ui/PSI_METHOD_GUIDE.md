# PSI Method Generation Guide

This document explains which methods are automatically generated by Grammar-Kit and which require manual implementation in `UiPsiImplUtil`.

## Auto-Generated Methods

Grammar-Kit **automatically generates** accessor methods for:

1. **Child elements** - Any child element referenced in a BNF rule
2. **Token accessors** - Methods to access specific tokens

### Examples:

```bnf
variableDeclaration ::= AT IDENTIFIER EQUALS value SEMICOLON
```

**Auto-generated methods:**
- `getValue()` - Returns the `value` child element
- `getIdentifier()` - Returns the `IDENTIFIER` token

```bnf
componentUsage ::= componentReference componentBody
```

**Auto-generated methods:**
- `getComponentReference()` - Returns the `componentReference` child
- `getComponentBody()` - Returns the `componentBody` child

```bnf
qualifiedComponentRef ::= variable DOT AT IDENTIFIER
```

**Auto-generated methods:**
- `getVariable()` - Returns the `variable` child

## Manual Methods (in UiPsiImplUtil)

You need to **manually implement** in `UiPsiImplUtil` for:

1. **PsiNameIdentifierOwner methods** - Required for rename refactoring
   - `getName()` - Extract name from identifier
   - `setName(String)` - Rename the element
   - `getNameIdentifier()` - Get the PSI element that holds the name

2. **Custom logic methods** - Methods that require computation or special logic
   - `getReferenceName()` - Extract name from either simple or qualified reference
   - `getQualifier()` - Get the qualifier part of a qualified reference
   - `getComponentName()` - Extract component name from IDENTIFIER token
   - `getPropertyName()` - Extract property name from IDENTIFIER token
   - `getReference()` - Create a PsiReference for resolution
   - `getImportedFile()` - Resolve imported file path

## BNF Declaration

### For Auto-Generated Methods
**Don't list them in `methods=[]`** - Grammar-Kit generates them automatically.

```bnf
// ✅ CORRECT - getValue() is auto-generated
variableDeclaration ::= AT IDENTIFIER EQUALS value SEMICOLON {
  implements="com.intellij.psi.PsiNameIdentifierOwner"
  methods=[
    getName
    setName
    getNameIdentifier
  ]
}
```

```bnf
// ❌ WRONG - getValue() is listed but already auto-generated
variableDeclaration ::= AT IDENTIFIER EQUALS value SEMICOLON {
  implements="com.intellij.psi.PsiNameIdentifierOwner"
  methods=[
    getName
    setName
    getNameIdentifier
    getValue  // ❌ Duplicate! Causes compilation error
  ]
}
```

### For Manual Methods
**Do list them in `methods=[]`** and implement in `UiPsiImplUtil`.

```bnf
// ✅ CORRECT - Custom logic methods listed
componentReference ::= qualifiedComponentRef | simpleComponentRef {
  methods=[
    getReferenceName  // Custom: extract name from either child type
    getQualifier      // Custom: get qualifier from qualified reference
  ]
}
```

## Current Manual Methods in UiPsiImplUtil

### UiVariableDeclaration
- `getName()` - Extract name from IDENTIFIER token
- `setName(String)` - Rename by replacing IDENTIFIER
- `getNameIdentifier()` - Return IDENTIFIER token

### UiComponentDefinition
- `getName()` - Extract name from IDENTIFIER token
- `setName(String)` - Rename by replacing IDENTIFIER
- `getNameIdentifier()` - Return IDENTIFIER token

### UiVariable
- `getName()` - Extract name from IDENTIFIER token
- `setName(String)` - Rename by replacing IDENTIFIER
- `getReference()` - Create `UiVariableReferenceImpl` for resolution

### UiIdDeclaration
- `getName()` - Extract name from IDENTIFIER token
- `setName(String)` - Rename by replacing IDENTIFIER
- `getNameIdentifier()` - Return IDENTIFIER token

### UiComponentReference
- `getReferenceName()` - Get name from either `UiSimpleComponentRef` or `UiQualifiedComponentRef`
- `getQualifier()` - Get variable qualifier from `UiQualifiedComponentRef`

### UiQualifiedComponentRef
- `getComponentName()` - Extract component name from IDENTIFIER token

### UiSimpleComponentRef
- `getComponentName()` - Extract component name from IDENTIFIER token

### UiProperty
- `getPropertyName()` - Extract property name from IDENTIFIER token

### UiImportStatement
- `getImportedFile()` - Resolve STRING token to PsiFile (custom resolution logic)

## Debugging Duplicate Methods

If you see compilation errors like:
```
'getValue()' is already defined in 'UiVariableDeclaration'
```

**Cause:** The method is listed in `methods=[]` in the BNF, but it's also auto-generated because a child element with that name exists.

**Fix:** Remove the method from the `methods=[]` list in the BNF file and regenerate PSI classes.

## Workflow

1. **Edit Ui.bnf** - Define grammar rules
2. **List only custom methods** in `methods=[]` blocks
3. **Generate Parser** - Right-click Ui.bnf → "Generate Parser Code"
4. **Generate PSI** - Right-click Ui.bnf → "Generate PSI Classes"
5. **Implement custom methods** in `UiPsiImplUtil`
6. **Build project** - Verify no duplicate method errors

## Reference

See these files for examples:
- `Ui.bnf` - Grammar with proper `methods=[]` declarations
- `UiPsiImplUtil.java` - Manual method implementations
- Generated `psi/` interfaces - Shows all available methods
- Generated `psi/impl/` classes - Shows which call UiPsiImplUtil
